{"ast":null,"code":"var _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = scheduleNotificationAsync;\n\nvar _objectWithoutProperties2 = _interopRequireDefault(require(\"@babel/runtime/helpers/objectWithoutProperties\"));\n\nvar _regenerator = _interopRequireDefault(require(\"@babel/runtime/regenerator\"));\n\nvar _core = require(\"@unimodules/core\");\n\nvar _v = _interopRequireDefault(require(\"uuid/v4\"));\n\nvar _NotificationScheduler = _interopRequireDefault(require(\"./NotificationScheduler\"));\n\nfunction scheduleNotificationAsync(request) {\n  var _request$identifier;\n\n  return _regenerator.default.async(function scheduleNotificationAsync$(_context) {\n    while (1) {\n      switch (_context.prev = _context.next) {\n        case 0:\n          if (_NotificationScheduler.default.scheduleNotificationAsync) {\n            _context.next = 2;\n            break;\n          }\n\n          throw new _core.UnavailabilityError('Notifications', 'scheduleNotificationAsync');\n\n        case 2:\n          _context.next = 4;\n          return _regenerator.default.awrap(_NotificationScheduler.default.scheduleNotificationAsync((_request$identifier = request.identifier) != null ? _request$identifier : (0, _v.default)(), request.content, parseTrigger(request.trigger)));\n\n        case 4:\n          return _context.abrupt(\"return\", _context.sent);\n\n        case 5:\n        case \"end\":\n          return _context.stop();\n      }\n    }\n  }, null, null, null, Promise);\n}\n\nfunction parseTrigger(userFacingTrigger) {\n  if (userFacingTrigger === null) {\n    return null;\n  }\n\n  if (userFacingTrigger === undefined) {\n    throw new TypeError('Encountered an `undefined` notification trigger. If you want to trigger the notification immediately, pass in an explicit `null` value.');\n  }\n\n  if (userFacingTrigger instanceof Date) {\n    return {\n      type: 'date',\n      timestamp: userFacingTrigger.getTime()\n    };\n  } else if (typeof userFacingTrigger === 'number') {\n    return {\n      type: 'date',\n      timestamp: userFacingTrigger\n    };\n  } else if (isDailyTriggerInput(userFacingTrigger)) {\n    var hour = userFacingTrigger.hour;\n    var minute = userFacingTrigger.minute;\n\n    if (hour === undefined || hour == null || minute === undefined || minute == null) {\n      throw new TypeError('Both hour and minute need to have valid values. Found undefined');\n    }\n\n    if (hour < 0 || hour > 23) {\n      throw new RangeError(\"The hour parameter needs to be between 0 and 23. Found: \" + hour);\n    }\n\n    if (minute < 0 || minute > 59) {\n      throw new RangeError(\"The minute parameter needs to be between 0 and 59. Found: \" + minute);\n    }\n\n    return {\n      type: 'daily',\n      hour: hour,\n      minute: minute\n    };\n  } else if (isSecondsPropertyMisusedInCalendarTriggerInput(userFacingTrigger)) {\n    throw new TypeError('Could not have inferred the notification trigger type: if you want to use a time interval trigger, pass in only `seconds` with or without `repeats` property; if you want to use calendar-based trigger, pass in `second`.');\n  } else if ('seconds' in userFacingTrigger) {\n    var _userFacingTrigger$re;\n\n    return {\n      type: 'timeInterval',\n      seconds: userFacingTrigger.seconds,\n      repeats: (_userFacingTrigger$re = userFacingTrigger.repeats) != null ? _userFacingTrigger$re : false\n    };\n  } else {\n    var repeats = userFacingTrigger.repeats,\n        calendarTrigger = (0, _objectWithoutProperties2.default)(userFacingTrigger, [\"repeats\"]);\n    return {\n      type: 'calendar',\n      value: calendarTrigger,\n      repeats: repeats\n    };\n  }\n}\n\nfunction isDailyTriggerInput(trigger) {\n  return Object.keys(trigger).length === 3 && 'hour' in trigger && 'minute' in trigger && 'repeats' in trigger && trigger.repeats === true;\n}\n\nfunction isSecondsPropertyMisusedInCalendarTriggerInput(trigger) {\n  return 'seconds' in trigger && 'repeats' in trigger && Object.keys(trigger).length > 2 || 'seconds' in trigger && !('repeats' in trigger) && Object.keys(trigger).length > 1;\n}","map":{"version":3,"sources":["../src/scheduleNotificationAsync.ts"],"names":[],"mappings":"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","sourcesContent":["import { UnavailabilityError } from '@unimodules/core';\nimport uuidv4 from 'uuid/v4';\n\nimport NotificationScheduler from './NotificationScheduler';\nimport { NotificationTriggerInput as NativeNotificationTriggerInput } from './NotificationScheduler.types';\nimport {\n  NotificationRequestInput,\n  NotificationTriggerInput,\n  DailyTriggerInput,\n  CalendarTriggerInput,\n  TimeIntervalTriggerInput,\n} from './Notifications.types';\n\nexport default async function scheduleNotificationAsync(\n  request: NotificationRequestInput\n): Promise<string> {\n  if (!NotificationScheduler.scheduleNotificationAsync) {\n    throw new UnavailabilityError('Notifications', 'scheduleNotificationAsync');\n  }\n\n  return await NotificationScheduler.scheduleNotificationAsync(\n    request.identifier ?? uuidv4(),\n    request.content,\n    parseTrigger(request.trigger)\n  );\n}\n\nfunction parseTrigger(userFacingTrigger: NotificationTriggerInput): NativeNotificationTriggerInput {\n  if (userFacingTrigger === null) {\n    return null;\n  }\n\n  if (userFacingTrigger === undefined) {\n    throw new TypeError(\n      'Encountered an `undefined` notification trigger. If you want to trigger the notification immediately, pass in an explicit `null` value.'\n    );\n  }\n\n  if (userFacingTrigger instanceof Date) {\n    return { type: 'date', timestamp: userFacingTrigger.getTime() };\n  } else if (typeof userFacingTrigger === 'number') {\n    return { type: 'date', timestamp: userFacingTrigger };\n  } else if (isDailyTriggerInput(userFacingTrigger)) {\n    const hour = userFacingTrigger.hour;\n    const minute = userFacingTrigger.minute;\n    if (hour === undefined || hour == null || minute === undefined || minute == null) {\n      throw new TypeError('Both hour and minute need to have valid values. Found undefined');\n    }\n    if (hour < 0 || hour > 23) {\n      throw new RangeError(`The hour parameter needs to be between 0 and 23. Found: ${hour}`);\n    }\n    if (minute < 0 || minute > 59) {\n      throw new RangeError(`The minute parameter needs to be between 0 and 59. Found: ${minute}`);\n    }\n    return {\n      type: 'daily',\n      hour,\n      minute,\n    };\n  } else if (isSecondsPropertyMisusedInCalendarTriggerInput(userFacingTrigger)) {\n    throw new TypeError(\n      'Could not have inferred the notification trigger type: if you want to use a time interval trigger, pass in only `seconds` with or without `repeats` property; if you want to use calendar-based trigger, pass in `second`.'\n    );\n  } else if ('seconds' in userFacingTrigger) {\n    return {\n      type: 'timeInterval',\n      seconds: userFacingTrigger.seconds,\n      repeats: userFacingTrigger.repeats ?? false,\n    };\n  } else {\n    const { repeats, ...calendarTrigger } = userFacingTrigger;\n    return { type: 'calendar', value: calendarTrigger, repeats };\n  }\n}\n\nfunction isDailyTriggerInput(\n  trigger: DailyTriggerInput | CalendarTriggerInput | TimeIntervalTriggerInput\n): trigger is DailyTriggerInput {\n  return (\n    Object.keys(trigger).length === 3 &&\n    'hour' in trigger &&\n    'minute' in trigger &&\n    'repeats' in trigger &&\n    trigger.repeats === true\n  );\n}\n\nfunction isSecondsPropertyMisusedInCalendarTriggerInput(\n  trigger: TimeIntervalTriggerInput | CalendarTriggerInput\n) {\n  return (\n    // eg. { seconds: ..., repeats: ..., hour: ... }\n    ('seconds' in trigger && 'repeats' in trigger && Object.keys(trigger).length > 2) ||\n    // eg. { seconds: ..., hour: ... }\n    ('seconds' in trigger && !('repeats' in trigger) && Object.keys(trigger).length > 1)\n  );\n}\n"],"sourceRoot":""},"metadata":{},"sourceType":"script"}